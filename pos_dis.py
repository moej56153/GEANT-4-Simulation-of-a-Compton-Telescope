import numpy as np
import matplotlib.pyplot as plt
import reading_data as rd
import ang_tof as at
from scipy.integrate import quad



def events_per_cell(forward=True,D1=True,text=True):
    d=rd.read_h5py_file()
    if forward:
        d=rd.cut_selection(d, 9, 0)
        if D1:
            N=Nfor1
            par1=5
            par2=7
            points=rd.D1_points
        else:
            N=Nfor2
            par1=11
            par2=13
            points=rd.D2_points
    else:
        d=rd.cut_selection(d, 9, 0,False)
        if D1:
            N=Nba1
            par1=11
            par2=13
            points=rd.D1_points
        else:
            N=Nba2
            par1=5
            par2=7
            points=rd.D2_points
    rd.plot_histogram_2D(d, par1, par2)
    s=0
    for i in N:
        s+=i
    N=N*len(d)/s
    if text:
        for i in range(len(points)):
            plt.text(points[i,0],points[i,1],"M="+str(len(rd.select_cell(d, i,forward,D1)))+"\n E="+str(int(N[i])),ha="center",
                     va="center",bbox=dict(facecolor='white', edgecolor='none'))






def cxn(sad,forward,D1,length=211):
    interval=round(0.7/(length-1),7)
    if forward:
        angles=[interval*i for i in range(length)]
        x_min,x_max=at.fsad_min,at.fsad_max
        if not D1:
            sad=sad[::-1]
    else:
        angles=[interval*i+(np.pi-0.7) for i in range(length)]
        x_min,x_max=at.bsad_min,at.bsad_max
        if D1:
            sad=sad[::-1]
    N=np.zeros(length)
    E=np.zeros(length)
    for i in range(length):
        #print(i,angles[i])
        N[i],E[i]=quad(integrand,at.E_min,at.E_max,(angles[i],sad,forward,x_min,x_max),0,1e-10,1e-10)
    return N

def integrand(E,theta_S,sad,forward,x_min,x_max):

    p1=rd.continue_line(theta_S,sad,x_min,x_max)
    p2=at.klein_nishina(E,theta_S)
    p3=at.energy_limit_factor(E,theta_S,forward)*1e35
    p4=at.energy_distribution(E)
    #print(p1*p2*p3*p4,p1,p2,p3,p4,E,theta_S)
    return p1*p2*p3*p4
    

def calculate_expected_number(forward,D1):
    if D1:
        D=np.array([cxn(D1_0,forward,D1),cxn(D1_1,forward,D1),cxn(D1_2,forward,D1),cxn(D1_3,forward,D1),
                    cxn(D1_4,forward,D1),cxn(D1_5,forward,D1),cxn(D1_6,forward,D1)])
    else:
        D=np.array([cxn(D2_0,forward,D1),cxn(D2_1,forward,D1),cxn(D2_2,forward,D1),cxn(D2_3,forward,D1),
                    cxn(D2_4,forward,D1),cxn(D2_5,forward,D1),
                    cxn(D2_6,forward,D1),cxn(D2_7,forward,D1),cxn(D2_8,forward,D1),cxn(D2_9,forward,D1),cxn(D2_10,forward,D1),
                    cxn(D2_11,forward,D1),cxn(D2_12,forward,D1),cxn(D2_13,forward,D1)])
    N=np.zeros(len(D))
    for cell in range(len(D)):
        s=0
        for i in range(len(D[cell])):
            s+=D[cell,i]
        N[cell]=s
    return N




Nfor1=np.array([9589406.44666452, 8629545.41704423, 8629355.00596077,
       8629636.11275253, 8629827.22425049, 8803814.36549603,
       8803814.36549603])
Nfor2=np.array([4439809.62902123, 4439662.7262388 , 4183196.43009784,
       4183258.86416483, 4183509.94212951, 4183447.50806252,
       4199576.97164874, 4199416.42856343, 4199985.50402052,
       4200146.33012357, 4610460.60057198, 4610559.02349527,
       4611112.2860214 , 4610895.9783796 ])
Nba1=np.array([1576628.33813019, 1473905.74548107, 1473911.54635198,
       1473940.39537836, 1473934.72488543, 1492686.1337536 ,
       1492686.1337536 ])
Nba2=np.array([737586.54245587, 737549.41929116, 717751.81704457, 717765.09380922,
       717800.52212329, 717787.24535865, 725082.01450116, 725039.04189867,
       725159.70281818, 725202.70452077, 766181.99441078, 766198.12666597,
       766262.74407687, 766229.40360187])


D1_0=np.array([0.00000000e+00, 2.09732987e+01, 4.23016911e+01, 6.43886113e+01,
       8.81068113e+01, 1.15467090e+02, 1.46401369e+02, 1.79839196e+02,
       2.15073955e+02, 2.51414712e+02, 2.89217521e+02, 3.27054614e+02,
       3.63244859e+02, 3.95817283e+02, 4.21597289e+02, 4.40961092e+02,
       4.60847647e+02, 4.82503257e+02, 5.07112836e+02, 5.34612700e+02,
       5.65713396e+02, 5.99658499e+02, 6.36560388e+02, 6.75723923e+02,
       7.15889053e+02, 7.55506575e+02, 7.91255456e+02, 8.21344663e+02,
       8.46207549e+02, 8.63895598e+02, 8.69178710e+02, 8.60842688e+02,
       8.32347615e+02, 7.85546593e+02, 7.25811683e+02, 6.56960001e+02,
       5.81767688e+02, 5.02828933e+02, 4.22778718e+02, 3.44024622e+02,
       2.69292781e+02, 2.00717167e+02, 1.41220248e+02, 9.14194273e+01,
       5.11110351e+01, 2.26095627e+01, 7.29934056e+00, 4.72229490e-01,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00])
D1_1=np.array([  0.        ,  32.02834321,  63.96804891,  95.03247521,
       123.01552632, 148.38045948, 171.37931485, 192.22931849,
       210.95743742, 227.65725691, 242.28269071, 254.9472965 ,
       265.69533035, 274.75144203, 283.01837025, 291.16751755,
       299.48492413, 304.25990534, 305.11175488, 305.69029163,
       307.74869126, 310.58247149, 313.7948828 , 315.85236372,
       318.68082869, 322.14102687, 326.91261438, 333.97893271,
       342.24617059, 351.3757213 , 360.93441208, 371.50174319,
       382.15739409, 397.67843091, 411.88890463, 421.75719199,
       427.47439776, 430.88612835, 432.87990269, 433.88446907,
       433.79117064, 431.90578417, 428.60858152, 425.66496766,
       422.51713238, 419.30365219, 416.1260626 , 409.77979298,
       402.0842723 , 392.06220163, 381.1436544 , 366.51284424,
       346.53803288, 322.10932034, 293.97192248, 263.24416007,
       231.35244997, 198.52647535, 165.371277  , 133.72054795,
       105.48918904,  80.03425107,  59.03546298,  41.84142555,
        28.27789213,  17.70836525,  10.36077932,   4.81012614,
         1.21679271,   0.        ,   0.        ])
D1_2=np.array([  0.        ,  32.02858014,  63.96804891,  95.03247521,
       123.01552632, 148.38045948, 171.37931485, 192.22931849,
       210.95743742, 227.65725691, 242.28269071, 254.9472965 ,
       265.69533035, 274.75144203, 283.01847967, 291.16751755,
       299.48492413, 304.25990534, 305.64758618, 306.68770267,
       307.36628604, 310.58247149, 313.7948828 , 315.85236372,
       318.68082869, 322.14102687, 326.91261438, 333.97893271,
       342.24617059, 351.3757213 , 360.93441208, 371.50174319,
       381.3409784 , 397.67843091, 411.88445197, 421.75719199,
       427.47369095, 430.88612835, 432.87990269, 433.88446907,
       433.79117064, 431.90578417, 428.6082258 , 425.66496766,
       422.51713238, 419.30558668, 416.1260626 , 409.77709919,
       402.08444689, 392.06241681, 380.89614338, 366.51284424,
       346.53803288, 322.10932034, 293.97192248, 263.24416007,
       231.35125962, 198.52576206, 165.371277  , 133.71780736,
       105.48918904,  80.03425107,  59.03546298,  41.84142555,
        28.27789213,  17.70836525,  10.36077932,   4.81106361,
         1.21679271,   0.        ,   0.        ])
D1_3=np.array([  0.        ,  32.03647292,  63.98142943,  95.03551726,
       123.02610445, 148.37012298, 171.40127128, 192.1812189 ,
       210.91856619, 227.6940169 , 242.28269071, 254.9472965 ,
       265.71376917, 274.79001078, 283.02111565, 291.16582079,
       299.48846145, 304.2608662 , 305.69885886, 306.68771264,
       307.36628604, 310.58247149, 313.42737153, 315.85236372,
       318.68082869, 322.14102687, 327.30870909, 334.32591581,
       342.26001646, 351.37563894, 361.10176755, 371.49606903,
       381.3906993 , 397.66104487, 411.87742343, 421.75863909,
       427.55752246, 430.96754379, 432.87990269, 433.93297318,
       433.79400035, 431.90451236, 428.61446943, 425.63781115,
       422.51719214, 419.31855206, 415.6996058 , 409.7772215 ,
       402.0846021 , 392.4729196 , 380.90487842, 366.45648195,
       346.53835224, 322.10887273, 293.96558052, 263.22667029,
       231.35120892, 198.52070326, 165.11749726, 133.71780736,
       105.31015478,  80.03425107,  59.03546298,  41.84142555,
        28.27789213,  17.70836525,  10.36077932,   4.81106361,
         1.21679271,   0.        ,   0.        ])
D1_4=np.array([  0.        ,  32.03623598,  63.98142943,  95.03551726,
       123.02610445, 148.37012298, 171.40127128, 192.1812189 ,
       210.91856619, 227.6940169 , 242.28269071, 254.9472965 ,
       265.71376917, 274.79001078, 283.02100624, 291.16582079,
       299.48846145, 304.2608662 , 305.16302756, 305.6903016 ,
       307.74869126, 310.58247149, 313.42737153, 315.85236372,
       318.68082869, 322.14102687, 327.30870909, 334.32591581,
       342.26001646, 351.37563894, 361.10176755, 371.49606903,
       382.207115  , 397.66110821, 411.88187609, 421.75863909,
       427.55822927, 430.96754379, 432.87990269, 433.93297318,
       433.79400035, 431.90451236, 428.61482515, 425.63781115,
       422.51719214, 419.3168758 , 415.6996058 , 409.77991529,
       402.08442751, 392.47270442, 381.15238944, 366.45648195,
       346.53835224, 322.10887273, 293.96558052, 263.22667029,
       231.35239927, 198.52141655, 165.11881312, 133.72054795,
       105.31015478,  80.03425107,  59.03546298,  41.84142555,
        28.27789213,  17.70836525,  10.36077932,   4.81012614,
         1.21679271,   0.        ,   0.        ])
D1_5=np.array([0.00000000e+00, 2.61643522e+01, 5.19298924e+01, 7.74943639e+01,
       1.03234225e+02, 1.29056686e+02, 1.54809813e+02, 1.80225802e+02,
       2.05345485e+02, 2.30500700e+02, 2.52867590e+02, 2.71365990e+02,
       2.87912976e+02, 3.03201297e+02, 3.17529929e+02, 3.31003891e+02,
       3.42239805e+02, 3.54097164e+02, 3.63316582e+02, 3.69296560e+02,
       3.71785681e+02, 3.72546851e+02, 3.74698689e+02, 3.78847469e+02,
       3.85429076e+02, 3.94583444e+02, 4.05875697e+02, 4.17410730e+02,
       4.27126414e+02, 4.34704934e+02, 4.40234386e+02, 4.44349616e+02,
       4.47624165e+02, 4.49224550e+02, 4.49572479e+02, 4.49154428e+02,
       4.44170755e+02, 4.33438178e+02, 4.18537668e+02, 4.02773059e+02,
       3.87902361e+02, 3.75329214e+02, 3.66444648e+02, 3.61341915e+02,
       3.59301956e+02, 3.58343998e+02, 3.57759600e+02, 3.57398702e+02,
       3.55584451e+02, 3.50834409e+02, 3.43295183e+02, 3.31844744e+02,
       3.18433967e+02, 2.97530280e+02, 2.69959032e+02, 2.38285762e+02,
       2.04108713e+02, 1.68872136e+02, 1.33933052e+02, 1.00661895e+02,
       7.03439272e+01, 4.43695333e+01, 2.42065095e+01, 1.12330343e+01,
       3.50347658e+00, 9.08786346e-02, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00])
D1_6=np.array([0.00000000e+00, 2.61643522e+01, 5.19298924e+01, 7.74943639e+01,
       1.03234225e+02, 1.29056686e+02, 1.54809813e+02, 1.80225802e+02,
       2.05345485e+02, 2.30500700e+02, 2.52867590e+02, 2.71365990e+02,
       2.87912976e+02, 3.03201297e+02, 3.17529929e+02, 3.31003891e+02,
       3.42239805e+02, 3.54097164e+02, 3.63316582e+02, 3.69296560e+02,
       3.71785681e+02, 3.72546851e+02, 3.74698689e+02, 3.78847469e+02,
       3.85429076e+02, 3.94583444e+02, 4.05875697e+02, 4.17410730e+02,
       4.27126414e+02, 4.34704934e+02, 4.40234386e+02, 4.44349616e+02,
       4.47624165e+02, 4.49224550e+02, 4.49572479e+02, 4.49154428e+02,
       4.44170755e+02, 4.33438178e+02, 4.18537668e+02, 4.02773059e+02,
       3.87902361e+02, 3.75329214e+02, 3.66444648e+02, 3.61341915e+02,
       3.59301956e+02, 3.58343998e+02, 3.57759600e+02, 3.57398702e+02,
       3.55584451e+02, 3.50834409e+02, 3.43295183e+02, 3.31844744e+02,
       3.18433967e+02, 2.97530280e+02, 2.69959032e+02, 2.38285762e+02,
       2.04108713e+02, 1.68872136e+02, 1.33933052e+02, 1.00661895e+02,
       7.03439272e+01, 4.43695333e+01, 2.42065095e+01, 1.12330343e+01,
       3.50347658e+00, 9.08786346e-02, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00])
D2_0=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 1.36294167e-01,
       3.64514931e+00, 1.13470534e+01, 2.24276170e+01, 3.62197550e+01,
       5.20450048e+01, 6.91974409e+01, 8.70679307e+01, 1.05014168e+02,
       1.22266757e+02, 1.38286134e+02, 1.52293797e+02, 1.63652757e+02,
       1.74094067e+02, 1.81878328e+02, 1.86993074e+02, 1.88848185e+02,
       1.89584593e+02, 1.89865009e+02, 1.90056071e+02, 1.90377401e+02,
       1.90803769e+02, 1.92381652e+02, 1.95599624e+02, 2.00138868e+02,
       2.05209445e+02, 2.10042190e+02, 2.13068023e+02, 2.12442558e+02,
       2.09256574e+02, 2.05147355e+02, 2.02409497e+02, 2.01834223e+02,
       2.03141889e+02, 2.06028467e+02, 2.10117722e+02, 2.14863309e+02,
       2.19539372e+02, 2.22682399e+02, 2.24441405e+02, 2.25731557e+02,
       2.26901223e+02, 2.27958193e+02, 2.28796647e+02, 2.29075478e+02,
       2.26911765e+02, 2.21649145e+02, 2.09813097e+02, 1.92980226e+02,
       1.73671069e+02, 1.53325064e+02, 1.32879899e+02, 1.13023720e+02,
       9.43302781e+01, 7.71832709e+01, 6.18641970e+01, 4.80298209e+01,
       3.57386651e+01, 2.51743138e+01, 1.64969344e+01, 9.68744755e+00,
       4.80077746e+00, 1.75393017e+00, 1.94894057e-14])
D2_1=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 1.36294167e-01,
       3.64514931e+00, 1.13470534e+01, 2.24276170e+01, 3.62197550e+01,
       5.20450048e+01, 6.91974409e+01, 8.70679307e+01, 1.05014168e+02,
       1.22266757e+02, 1.38286134e+02, 1.52343067e+02, 1.63670582e+02,
       1.74094394e+02, 1.81878169e+02, 1.86985682e+02, 1.88848185e+02,
       1.89584593e+02, 1.89865009e+02, 1.90056071e+02, 1.90377401e+02,
       1.90803769e+02, 1.92381652e+02, 1.95599624e+02, 2.00138868e+02,
       2.05260535e+02, 2.10042190e+02, 2.13066889e+02, 2.12455902e+02,
       2.09256574e+02, 2.05147355e+02, 2.02426646e+02, 2.01834223e+02,
       2.03141889e+02, 2.06028467e+02, 2.10117722e+02, 2.14844384e+02,
       2.19540664e+02, 2.22682399e+02, 2.24427836e+02, 2.25731557e+02,
       2.26901223e+02, 2.27958193e+02, 2.28796647e+02, 2.29075478e+02,
       2.26911765e+02, 2.21067594e+02, 2.09813451e+02, 1.92980226e+02,
       1.73671069e+02, 1.53325064e+02, 1.32879899e+02, 1.13023720e+02,
       9.43302781e+01, 7.71832709e+01, 6.18641970e+01, 4.80298209e+01,
       3.57386651e+01, 2.51743138e+01, 1.64969344e+01, 9.68744755e+00,
       4.80077746e+00, 1.75393017e+00, 1.94894057e-14])
D2_2=np.array([0.00000000e+00, 0.00000000e+00, 1.08787946e+00, 4.55759196e+00,
       9.98026837e+00, 1.69442576e+01, 2.50505989e+01, 3.39132483e+01,
       4.37402379e+01, 5.63559052e+01, 7.22601751e+01, 9.08596486e+01,
       1.10970183e+02, 1.31337431e+02, 1.50155372e+02, 1.66782642e+02,
       1.80675332e+02, 1.91475831e+02, 1.99853579e+02, 2.05694879e+02,
       2.08537698e+02, 2.08232580e+02, 2.05143636e+02, 1.98226188e+02,
       1.89867830e+02, 1.81476195e+02, 1.74396747e+02, 1.69128580e+02,
       1.67017337e+02, 1.69118671e+02, 1.74293682e+02, 1.81568405e+02,
       1.90427648e+02, 2.00351663e+02, 2.10917815e+02, 2.21017839e+02,
       2.29623742e+02, 2.35786939e+02, 2.38989270e+02, 2.38278624e+02,
       2.33045904e+02, 2.24191326e+02, 2.12480532e+02, 1.98324340e+02,
       1.80869033e+02, 1.60986721e+02, 1.40345084e+02, 1.19875406e+02,
       1.00145665e+02, 8.18314204e+01, 6.57580292e+01, 5.49320329e+01,
       4.94973759e+01, 4.90022372e+01, 5.25298851e+01, 5.98586760e+01,
       7.14509478e+01, 8.49081957e+01, 9.82356679e+01, 1.10484405e+02,
       1.20917382e+02, 1.28846658e+02, 1.32872002e+02, 1.32776939e+02,
       1.28161529e+02, 1.18730444e+02, 1.04203584e+02, 8.42970834e+01,
       5.87480836e+01, 3.00765112e+01, 3.72112409e-13])
D2_3=np.array([0.00000000e+00, 0.00000000e+00, 1.08787946e+00, 4.55759196e+00,
       9.98026837e+00, 1.69442576e+01, 2.50505989e+01, 3.39139634e+01,
       4.38999279e+01, 5.63559052e+01, 7.22601751e+01, 9.08596486e+01,
       1.10970148e+02, 1.31337431e+02, 1.50155372e+02, 1.66782642e+02,
       1.80675332e+02, 1.91475831e+02, 1.99853579e+02, 2.05694879e+02,
       2.08537698e+02, 2.08232580e+02, 2.05143636e+02, 1.98226188e+02,
       1.89867137e+02, 1.81476195e+02, 1.74396747e+02, 1.69128580e+02,
       1.67017337e+02, 1.69125452e+02, 1.74293682e+02, 1.81568405e+02,
       1.90427648e+02, 2.00351663e+02, 2.10917815e+02, 2.21017839e+02,
       2.29623318e+02, 2.35786939e+02, 2.38989270e+02, 2.38278624e+02,
       2.33045904e+02, 2.24191326e+02, 2.12480532e+02, 1.98324340e+02,
       1.80869033e+02, 1.60986721e+02, 1.40345084e+02, 1.19875406e+02,
       1.00145665e+02, 8.18314204e+01, 6.57580292e+01, 5.49320329e+01,
       4.94976689e+01, 4.90022372e+01, 5.25298851e+01, 5.98586760e+01,
       7.14509478e+01, 8.49081957e+01, 9.82356679e+01, 1.10484405e+02,
       1.20917275e+02, 1.28846658e+02, 1.32872002e+02, 1.32776939e+02,
       1.28161529e+02, 1.18730444e+02, 1.04203584e+02, 8.42970834e+01,
       5.87480836e+01, 3.00765112e+01, 3.72112409e-13])
D2_4=np.array([0.00000000e+00, 0.00000000e+00, 1.08787946e+00, 4.55759196e+00,
       9.98026837e+00, 1.69442576e+01, 2.50505989e+01, 3.39139634e+01,
       4.38999279e+01, 5.63559052e+01, 7.22601751e+01, 9.08596486e+01,
       1.10970148e+02, 1.31337730e+02, 1.50155310e+02, 1.66782666e+02,
       1.80660193e+02, 1.91475831e+02, 1.99853579e+02, 2.05694879e+02,
       2.08546382e+02, 2.08640068e+02, 2.05143797e+02, 1.98236993e+02,
       1.89867326e+02, 1.81471100e+02, 1.74396747e+02, 1.69128580e+02,
       1.67017337e+02, 1.69125452e+02, 1.74293682e+02, 1.81568405e+02,
       1.90427648e+02, 2.00351663e+02, 2.10821095e+02, 2.21006854e+02,
       2.29623378e+02, 2.35795704e+02, 2.39007409e+02, 2.38450110e+02,
       2.33082034e+02, 2.24210176e+02, 2.12541072e+02, 1.98320376e+02,
       1.80855228e+02, 1.60986721e+02, 1.40345084e+02, 1.19852630e+02,
       1.00145665e+02, 8.17536551e+01, 6.57580292e+01, 5.49320329e+01,
       4.94976689e+01, 4.90022372e+01, 5.25298851e+01, 5.98660543e+01,
       7.14512349e+01, 8.49084430e+01, 9.82589533e+01, 1.10484405e+02,
       1.20917275e+02, 1.28734377e+02, 1.32872002e+02, 1.32776939e+02,
       1.28167194e+02, 1.18729135e+02, 1.04215153e+02, 8.42965113e+01,
       5.87654992e+01, 3.00758495e+01, 3.69056121e-13])
D2_5=np.array([0.00000000e+00, 0.00000000e+00, 1.08787946e+00, 4.55759196e+00,
       9.98026837e+00, 1.69442576e+01, 2.50505989e+01, 3.39132483e+01,
       4.37402379e+01, 5.63559052e+01, 7.22601751e+01, 9.08596486e+01,
       1.10970183e+02, 1.31337730e+02, 1.50155310e+02, 1.66782666e+02,
       1.80660193e+02, 1.91475831e+02, 1.99853579e+02, 2.05694879e+02,
       2.08546382e+02, 2.08640068e+02, 2.05143797e+02, 1.98236993e+02,
       1.89868019e+02, 1.81471100e+02, 1.74396747e+02, 1.69128580e+02,
       1.67017337e+02, 1.69118671e+02, 1.74293682e+02, 1.81568405e+02,
       1.90427648e+02, 2.00351663e+02, 2.10821095e+02, 2.21006854e+02,
       2.29623802e+02, 2.35795704e+02, 2.39007409e+02, 2.38450110e+02,
       2.33082034e+02, 2.24210176e+02, 2.12541072e+02, 1.98320376e+02,
       1.80855228e+02, 1.60986721e+02, 1.40345084e+02, 1.19852630e+02,
       1.00145665e+02, 8.17536551e+01, 6.57580292e+01, 5.49320329e+01,
       4.94973759e+01, 4.90022372e+01, 5.25298851e+01, 5.98660543e+01,
       7.14512349e+01, 8.49084430e+01, 9.82589533e+01, 1.10484405e+02,
       1.20917382e+02, 1.28734377e+02, 1.32872002e+02, 1.32776939e+02,
       1.28167194e+02, 1.18729135e+02, 1.04215153e+02, 8.42965113e+01,
       5.87654992e+01, 3.00758495e+01, 3.69056121e-13])
D2_6=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 2.49749828e-01, 4.05730603e+00, 1.21070054e+01,
       2.36203874e+01, 3.78349780e+01, 5.40527859e+01, 7.16091115e+01,
       9.10864909e+01, 1.12550492e+02, 1.34960907e+02, 1.57229753e+02,
       1.78239626e+02, 1.96639194e+02, 2.10226676e+02, 2.17909388e+02,
       2.19883989e+02, 2.18171888e+02, 2.14741641e+02, 2.10203150e+02,
       2.04606502e+02, 1.97782840e+02, 1.90755106e+02, 1.83837194e+02,
       1.77636723e+02, 1.72893475e+02, 1.69969940e+02, 1.68969737e+02,
       1.69771444e+02, 1.72323371e+02, 1.75777182e+02, 1.78746837e+02,
       1.80353844e+02, 1.81057720e+02, 1.81445787e+02, 1.81643816e+02,
       1.81296871e+02, 1.79510623e+02, 1.75739140e+02, 1.70493579e+02,
       1.65910597e+02, 1.62689891e+02, 1.61093822e+02, 1.60775987e+02,
       1.61256242e+02, 1.62439792e+02, 1.63805146e+02, 1.64199963e+02,
       1.63018887e+02, 1.60684980e+02, 1.56835143e+02, 1.53949320e+02,
       1.50067832e+02, 1.45594518e+02, 1.40623215e+02, 1.34194964e+02,
       1.25889381e+02, 1.14820708e+02, 1.02184185e+02, 8.95729688e+01,
       7.68541975e+01, 6.40018077e+01, 5.11340161e+01, 3.83218926e+01,
       2.56301602e+01, 1.29141543e+01, 1.55705028e-13])
D2_7=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 2.49749828e-01, 4.05729958e+00, 1.21065665e+01,
       2.36203874e+01, 3.78349780e+01, 5.40527859e+01, 7.16091115e+01,
       9.10864909e+01, 1.12550492e+02, 1.34960907e+02, 1.57229753e+02,
       1.78239626e+02, 1.96639194e+02, 2.10226676e+02, 2.17909388e+02,
       2.19883989e+02, 2.18172123e+02, 2.14741516e+02, 2.10203150e+02,
       2.04606502e+02, 1.97782840e+02, 1.90755106e+02, 1.83837194e+02,
       1.77634741e+02, 1.72893475e+02, 1.69971036e+02, 1.68969737e+02,
       1.69771444e+02, 1.72323371e+02, 1.75777182e+02, 1.78746948e+02,
       1.80353844e+02, 1.81057720e+02, 1.81444257e+02, 1.81643816e+02,
       1.81296871e+02, 1.79510623e+02, 1.75739140e+02, 1.70493579e+02,
       1.65910597e+02, 1.62689891e+02, 1.61094012e+02, 1.60775987e+02,
       1.61256242e+02, 1.62440212e+02, 1.63805146e+02, 1.64200211e+02,
       1.63018887e+02, 1.60684980e+02, 1.56835143e+02, 1.53950366e+02,
       1.49522800e+02, 1.45594518e+02, 1.40623215e+02, 1.34194964e+02,
       1.25889381e+02, 1.14820708e+02, 1.02184185e+02, 8.95729688e+01,
       7.68541975e+01, 6.40018077e+01, 5.11340161e+01, 3.83218926e+01,
       2.56302427e+01, 1.29141543e+01, 1.55705028e-13])
D2_8=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 2.49749828e-01, 4.05729958e+00, 1.21065665e+01,
       2.36203874e+01, 3.78349780e+01, 5.40527859e+01, 7.16091115e+01,
       9.10864909e+01, 1.12550492e+02, 1.34960907e+02, 1.57229753e+02,
       1.78239626e+02, 1.96617921e+02, 2.10227629e+02, 2.17909204e+02,
       2.19877084e+02, 2.18172123e+02, 2.14815010e+02, 2.10203150e+02,
       2.04559176e+02, 1.97783353e+02, 1.90755027e+02, 1.83860201e+02,
       1.77634741e+02, 1.72893475e+02, 1.70012188e+02, 1.68969737e+02,
       1.69771444e+02, 1.72323371e+02, 1.75792902e+02, 1.78746981e+02,
       1.80357345e+02, 1.81059714e+02, 1.81444257e+02, 1.81741465e+02,
       1.81296871e+02, 1.79510288e+02, 1.75739140e+02, 1.70485477e+02,
       1.65927444e+02, 1.62689891e+02, 1.61094012e+02, 1.60663793e+02,
       1.61634335e+02, 1.62440212e+02, 1.63785663e+02, 1.64203416e+02,
       1.62961727e+02, 1.60684980e+02, 1.57640710e+02, 1.54062682e+02,
       1.49522800e+02, 1.45771969e+02, 1.40623215e+02, 1.34262397e+02,
       1.25889381e+02, 1.14814970e+02, 1.02184185e+02, 8.95729688e+01,
       7.68541975e+01, 6.40018077e+01, 5.11340161e+01, 3.83218926e+01,
       2.56213305e+01, 1.29141543e+01, 1.55705028e-13])
D2_9=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 2.49749828e-01, 4.05730603e+00, 1.21070054e+01,
       2.36203874e+01, 3.78349780e+01, 5.40527859e+01, 7.16091115e+01,
       9.10864909e+01, 1.12550492e+02, 1.34960907e+02, 1.57229753e+02,
       1.78239626e+02, 1.96617921e+02, 2.10227629e+02, 2.17909204e+02,
       2.19877084e+02, 2.18171888e+02, 2.14815135e+02, 2.10203150e+02,
       2.04559176e+02, 1.97783353e+02, 1.90755027e+02, 1.83860201e+02,
       1.77636723e+02, 1.72893475e+02, 1.70012188e+02, 1.68969737e+02,
       1.69771444e+02, 1.72323371e+02, 1.75792902e+02, 1.78746870e+02,
       1.80357345e+02, 1.81059714e+02, 1.81445787e+02, 1.81741465e+02,
       1.81296871e+02, 1.79510288e+02, 1.75739140e+02, 1.70485477e+02,
       1.65927444e+02, 1.62689891e+02, 1.61093822e+02, 1.60663061e+02,
       1.61634335e+02, 1.62439792e+02, 1.63785663e+02, 1.64203168e+02,
       1.62961727e+02, 1.60684980e+02, 1.57640710e+02, 1.54061637e+02,
       1.50067832e+02, 1.45771969e+02, 1.40623215e+02, 1.34262397e+02,
       1.25889381e+02, 1.14814970e+02, 1.02184185e+02, 8.95729688e+01,
       7.68541975e+01, 6.40018077e+01, 5.11340161e+01, 3.83218926e+01,
       2.56212479e+01, 1.29141543e+01, 1.55705028e-13])
D2_10=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 6.03092676e-01,
       3.21304156e+00, 7.58366339e+00, 1.34008567e+01, 2.06122264e+01,
       3.04624649e+01, 4.28221577e+01, 5.86819137e+01, 7.75013041e+01,
       9.84394464e+01, 1.20837042e+02, 1.45277699e+02, 1.71050885e+02,
       1.96828465e+02, 2.21173084e+02, 2.42441009e+02, 2.60053051e+02,
       2.74416377e+02, 2.85228169e+02, 2.91689180e+02, 2.94138915e+02,
       2.93218866e+02, 2.88834542e+02, 2.83099630e+02, 2.77235380e+02,
       2.71661206e+02, 2.67170511e+02, 2.63236966e+02, 2.61122950e+02,
       2.60605347e+02, 2.63562420e+02, 2.66446290e+02, 2.70842982e+02,
       2.75208962e+02, 2.79294067e+02, 2.82352056e+02, 2.82884801e+02,
       2.79689918e+02, 2.73510689e+02, 2.63164882e+02, 2.48596334e+02,
       2.31263861e+02, 2.10941820e+02, 1.88369192e+02, 1.64816748e+02,
       1.41128199e+02, 1.18185303e+02, 9.64566976e+01, 7.64830618e+01,
       5.86541703e+01, 4.32274162e+01, 3.04915898e+01, 2.05415833e+01,
       1.24730489e+01, 5.84949565e+00, 7.03665412e-14])
D2_11=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 6.03092676e-01,
       3.21304156e+00, 7.58366339e+00, 1.34008567e+01, 2.06122264e+01,
       3.04624649e+01, 4.30201210e+01, 5.86819137e+01, 7.75017108e+01,
       9.84361993e+01, 1.20836344e+02, 1.45277699e+02, 1.71050885e+02,
       1.96827614e+02, 2.21173084e+02, 2.42441009e+02, 2.60053051e+02,
       2.74416377e+02, 2.85228169e+02, 2.91689180e+02, 2.94138915e+02,
       2.93220609e+02, 2.88834542e+02, 2.83099630e+02, 2.77235380e+02,
       2.71661206e+02, 2.67170511e+02, 2.63236966e+02, 2.61132930e+02,
       2.60605347e+02, 2.63562420e+02, 2.66446290e+02, 2.70842982e+02,
       2.75208962e+02, 2.79294067e+02, 2.82351836e+02, 2.82884801e+02,
       2.79689918e+02, 2.73510689e+02, 2.63164882e+02, 2.48596334e+02,
       2.31261797e+02, 2.10941820e+02, 1.88369192e+02, 1.64816748e+02,
       1.41128199e+02, 1.18185303e+02, 9.64566976e+01, 7.64830618e+01,
       5.86541703e+01, 4.32274162e+01, 3.04915898e+01, 2.05415833e+01,
       1.24732850e+01, 5.84949565e+00, 7.03665412e-14])
D2_12=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 6.03092676e-01,
       3.21304156e+00, 7.58366339e+00, 1.34008567e+01, 2.06122264e+01,
       3.04624649e+01, 4.30201210e+01, 5.86819137e+01, 7.75017108e+01,
       9.84361993e+01, 1.20836344e+02, 1.45277699e+02, 1.71050885e+02,
       1.96827614e+02, 2.21171482e+02, 2.42637602e+02, 2.60110033e+02,
       2.74416377e+02, 2.85317736e+02, 2.91689316e+02, 2.94246314e+02,
       2.93531615e+02, 2.88800858e+02, 2.83099630e+02, 2.77235380e+02,
       2.71807060e+02, 2.67170582e+02, 2.63236966e+02, 2.61505345e+02,
       2.60903611e+02, 2.62904525e+02, 2.66446290e+02, 2.70842982e+02,
       2.75208962e+02, 2.79294067e+02, 2.82351836e+02, 2.82875353e+02,
       2.79689918e+02, 2.73510689e+02, 2.63189902e+02, 2.48596334e+02,
       2.31261797e+02, 2.10936362e+02, 1.88369192e+02, 1.64816748e+02,
       1.41128199e+02, 1.18185303e+02, 9.64598078e+01, 7.64830618e+01,
       5.86541703e+01, 4.32274162e+01, 3.04915898e+01, 2.04603024e+01,
       1.24732850e+01, 5.84949565e+00, 7.03665412e-14])
D2_13=np.array([0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 6.03092676e-01,
       3.21304156e+00, 7.58366339e+00, 1.34008567e+01, 2.06122264e+01,
       3.04624649e+01, 4.28221577e+01, 5.86819137e+01, 7.75013041e+01,
       9.84394464e+01, 1.20837042e+02, 1.45277699e+02, 1.71050885e+02,
       1.96828465e+02, 2.21171482e+02, 2.42447114e+02, 2.60110033e+02,
       2.74416377e+02, 2.85317736e+02, 2.91689316e+02, 2.94246314e+02,
       2.93529872e+02, 2.88800858e+02, 2.83099630e+02, 2.77235380e+02,
       2.71807060e+02, 2.67170582e+02, 2.63236966e+02, 2.61495365e+02,
       2.60903611e+02, 2.62904525e+02, 2.66446290e+02, 2.70842982e+02,
       2.75208962e+02, 2.79294067e+02, 2.82352056e+02, 2.82875353e+02,
       2.79689918e+02, 2.73510689e+02, 2.63164882e+02, 2.48596334e+02,
       2.31261797e+02, 2.10936362e+02, 1.88369192e+02, 1.64816748e+02,
       1.41128199e+02, 1.18185303e+02, 9.64598078e+01, 7.64830618e+01,
       5.86541703e+01, 4.32274162e+01, 3.04915898e+01, 2.04603024e+01,
       1.24730489e+01, 5.84949565e+00, 7.03665412e-14])
D1=D1_0+D1_1+D1_2+D1_3+D1_4+D1_5+D1_6
D2=D2_0+D2_1+D2_2+D2_3+D2_4+D2_5+D2_6+D2_7+D2_8+D2_9+D2_10+D2_11+D2_12+D2_13

NF=np.array([0.00000000e+00, 6.60804949e+02, 3.99948720e+03, 1.02222414e+04,
       1.91748123e+04, 3.07632014e+04, 4.48550510e+04, 6.12382826e+04,
       7.97094750e+04, 1.00086227e+05, 1.21769759e+05, 1.44220277e+05,
       1.67248594e+05, 1.90554834e+05, 2.13915671e+05, 2.37404635e+05,
       2.61400255e+05, 2.84868667e+05, 3.06848380e+05, 3.28533972e+05,
       3.50357581e+05, 3.73298987e+05, 3.97410186e+05, 4.22363779e+05,
       4.49023712e+05, 4.77327944e+05, 5.07255435e+05, 5.38288259e+05,
       5.69012510e+05, 5.98801256e+05, 6.26124601e+05, 6.51001180e+05,
       6.71239393e+05, 6.91450108e+05, 6.97401790e+05, 6.78504827e+05,
       6.53378875e+05, 6.23865765e+05, 5.92095295e+05, 5.60400250e+05,
       5.29841457e+05, 5.00853111e+05, 4.74700838e+05, 4.52656567e+05,
       4.33869483e+05, 4.17964778e+05, 4.04710787e+05, 3.91447596e+05,
       3.78065616e+05, 3.62814826e+05, 3.46230927e+05, 3.26919520e+05,
       3.04380684e+05, 2.77744664e+05, 2.47968939e+05, 2.16634595e+05,
       1.85116078e+05, 1.53966988e+05, 1.23827922e+05, 9.61847550e+04,
       7.19959352e+04, 5.13086149e+04, 3.49964356e+04, 2.28822877e+04,
       1.41915380e+04, 8.22391505e+03, 4.70444710e+03, 2.14125154e+03,
       5.30963186e+02, 0.00000000e+00, 0.00000000e+00])
NB=np.array([    0.        ,     0.        ,   116.34191713,   482.20239686,
        1065.88464836,  1835.11451973,  3104.72161642,  4912.89934389,
        7378.8206218 , 10632.70291568, 14634.39276621, 19205.03771507,
       24243.89364008, 29586.65348961, 34898.43787264, 40025.95000293,
       44900.69834097, 49288.59839826, 52955.86104788, 55730.30529404,
       57812.46102038, 59327.43921511, 60534.38061558, 61384.81923966,
       62135.77650545, 62889.54921622, 63969.5543205 , 65400.97661596,
       67244.63334543, 69597.5526802 , 72234.83747636, 74967.73571582,
       77745.24273723, 80436.76738404, 82724.14483101, 84314.64985017,
       85115.79300178, 85122.42212889, 84735.14735553, 84027.3822718 ,
       82899.54716522, 81433.3923793 , 79591.84526228, 77578.88906968,
       75435.37698854, 73418.6632075 , 71498.42271249, 69825.169266  ,
       68338.79113379, 66989.66722428, 65803.51525417, 64770.46740029,
       63615.69583062, 62373.57146005, 60683.22213449, 58693.41066114,
       56628.81941358, 54403.25876516, 51825.45933495, 48920.43448823,
       45669.38558851, 42023.04620381, 38039.04398891, 33881.50061802,
       29545.39947381, 25032.47078696, 20366.07045916, 15526.12967763,
       10414.99984417,  5216.76242938,     0.        ])

def plot_ang_dist(forward,num_bins=100,data_array=None):
    d=rd.read_h5py_file()
    d=rd.cut_selection(d,9,0,forward)
    a=rd.calculate_angles(d)
    a=data_array if not type(data_array)==type(None) else a
    n,bins,patches=plt.hist(a,num_bins)
    if forward:
        D=NF
        x_min=at.fsad_min
        x_max=at.fsad_max
    else:
        D=NB
        x_min=at.bsad_min
        x_max=at.bsad_max
    D=D*np.amax(n)/np.amax(D)
    rd.plot_points(D,x_min,x_max,2.0)
    #plt.xlabel("Scattering Angle [rad]")
    #plt.ylabel("Frequency [Counts/Bins]")
    
    
    






